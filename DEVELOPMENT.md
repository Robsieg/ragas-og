# Development Guide for ragas

This document provides guidelines for developing and contributing to the ragas project.

## Monorepo Structure

This repository is organized as a monorepo containing multiple projects:

1. **Ragas Core Library** - A comprehensive evaluation toolkit for LLM applications
2. **Ragas Experimental** - An nbdev-based experimental project for Ragas extensions and UI components

The directory structure is as follows:

```
/
├── ragas/           # Main ragas project (src/ragas)
│   ├── src/         # Original source code
│   ├── tests/       # Original tests
│   ├── pyproject.toml  # ragas-specific build config
│
├── experimental/    # nbdev-based experimental project
│   ├── nbs/         # Notebooks for nbdev  
│   ├── ragas_experimental/  # Generated code
│   ├── pyproject.toml  # experimental-specific config
│   ├── settings.ini    # nbdev config
│
├── docs/            # Combined documentation
│   ├── main/        # Main ragas docs
│   ├── experimental/  # Experimental docs (generated by nbdev)
│
├── scripts/         # Shared build/CI scripts
│
├── workspace.toml   # Root project config (for dev tools)
├── Makefile         # Combined build commands
└── README.md        # Monorepo overview
```

## Setting up the Development Environment

1. **Fork the Repository**
   Fork the [ragas repository](https://github.com/explodinggradients/ragas) on GitHub.

2. **Clone your Fork**
   ```
   git clone https://github.com/YOUR_USERNAME/ragas.git
   cd ragas
   ```

3. **Set up a Virtual Environment**
   ```
   python -m venv venv
   source venv/bin/activate  # On Windows, use `venv\Scripts\activate`
   ```

4. **Install Dependencies**
   ```
   pip install -U setuptools  # Required on newer Python versions (e.g., 3.11)
   pip install -e ".[dev]"
   ```

## Development Workflow

1. **Create a New Branch**
   ```
   git checkout -b feature/your-feature-name
   ```

2. **Make Changes and Commit**
   ```
   git add .
   git commit -m "Your descriptive commit message"
   ```

3. **Push Changes to Your Fork**
   ```
   git push origin feature/your-feature-name
   ```

4. **Create a Pull Request**
   Go to the original ragas repository and create a new pull request from your feature branch.

## Monorepo Development

This monorepo uses a unified Makefile to manage both projects. Here are some common commands:

### Setting Up Both Projects

Install development dependencies for both projects:
```bash
# For ragas core
pip install -e ".[dev]"

# For experimental project
pip install -e "./experimental[dev]"
```

### Code Quality Commands

```bash
# Format all code
make format-all

# Lint all code
make lint-all

# Type check all code
make type-all
```

You can also work with individual projects:

```bash
# For ragas core only
make format
make lint
make type

# For experimental only
make format-experimental
make lint-experimental
make type-experimental
```

### Testing Commands

```bash
# Run all tests
make test-all

# Run ragas core tests
make test

# Run experimental tests
make test-experimental
```

### Documentation Commands

```bash
# Build all documentation
make build-docsite

# Build ragas core docs
make build-docsite-ragas

# Build experimental docs
make build-docsite-experimental

# Serve documentation locally
make serve-docsite
```

### Project-Specific Development

#### Ragas Core
For the main Ragas library, follow the standard development workflow described above.

#### Experimental Project
The experimental project uses [nbdev](https://nbdev.fast.ai/) for development:

1. Make changes in the notebook files in `experimental/nbs/`
2. Run `nbdev_export` to generate Python code
3. Run tests with `pytest` in the experimental directory
4. Generate docs with `nbdev_docs`

When submitting pull requests, please specify which project your changes affect:
- `[ragas]` for core library changes
- `[experimental]` for experimental project changes
- `[monorepo]` for changes that affect the overall repository structure

## Coding Standards

- Follow PEP 8 guidelines for Python code.
- Use type hints where possible.
- Write docstrings for all functions, classes, and modules.
- Ensure all tests pass before submitting a pull request.

You can run the following command to check for code style issues:
```bash
make run-ci
```

Adding a `V=1` option makes the output more verbose, showing normally hidden commands, like so:
```bash
make run-ci V=1
```

## Running Tests

To run the test suite:

```bash
make test
```

## Documentation

- Update documentation for any new features or changes to existing functionality.
- Use [Google style](https://sphinxcontrib-napoleon.readthedocs.io/en/latest/example_google.html) for docstrings.

## Submitting Pull Requests

1. Ensure your code adheres to the project's coding standards.
2. Include tests for new functionality.
3. Update documentation as necessary.
4. Provide a clear description of the changes in your pull request.

Thank you for contributing to ragas!


## Debugging Logs

To view the debug logs for any module, you can set the following.
```py
import logging

# Configure logging for the ragas._analytics module
analytics_logger = logging.getLogger('ragas._analytics')
analytics_logger.setLevel(logging.DEBUG)

# Create a console handler and set its level
console_handler = logging.StreamHandler()
console_handler.setLevel(logging.DEBUG)

# Create a formatter and add it to the handler
formatter = logging.Formatter('%(name)s - %(levelname)s - %(message)s')
console_handler.setFormatter(formatter)

# Add the handler to the logger
analytics_logger.addHandler(console_handler)
```